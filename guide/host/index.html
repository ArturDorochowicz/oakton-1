<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Integration with IHost | Oakton</title>
    <meta name="description" content="Add Robust Command Line Options to .Net Applications">
    <link rel="stylesheet" href="/assets/style.13643d27.css">
    <link rel="modulepreload" href="/assets/Home.22248d41.js">
    <link rel="modulepreload" href="/assets/AlgoliaSearchBox.23657f47.js">
    <link rel="modulepreload" href="/assets/app.148d2893.js">
    <link rel="modulepreload" href="/assets/guide_host_index.md.9f9fb1df.lean.js">
    
    <meta name="twitter:title" content="Integration with IHost | Oakton">
    <meta property="og:title" content="Integration with IHost | Oakton">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Oakton, back to home" data-v-675d8756 data-v-4a583abe><!----> Oakton</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/guide/" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://gitter.im/JasperFx/oakton?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Gitter | Join Chat <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/JasperFx/oakton" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/guide/" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://gitter.im/JasperFx/oakton?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Gitter | Join Chat <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/JasperFx/oakton" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/guide/">Getting Started</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/guide/commands">Commands</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/guide/host/">Integration with IHost</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/guide/host/run">Improved &quot;Run&quot; Command</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/guide/host/environment">Environment Checks</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/guide/host/extensions">Writing Extension Commands</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/guide/host/describe">The &quot;describe&quot; command</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/guide/host/resources">Stateful Resources</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/guide/bootstrapping">Bootstrapping with CommandExecutor</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/guide/parsing">Parsing Arguments and Optional Flags</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/guide/help">Help Text</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/guide/opts">&quot;Opts&quot; Files</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/guide/discovery">Command Assembly Discovery</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="integration-with-ihost" tabindex="-1">Integration with IHost <a class="header-anchor" href="#integration-with-ihost" aria-hidden="true">#</a></h1><div class="tip custom-block"><p class="custom-block-title">warning</p><p>The functionality to integrate Oakton into .Net Core projects in <em>Oakton.AspNetCore</em> was combined into the main Oakton library for V3.0.</p></div><p>Oakton works well with the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-5.0" target="_blank" rel="noopener noreferrer">generic HostBuilder</a> in .Net Core and .Net 5 to extend the command line support of your applications.</p><ul><li><a href="/guide/host/run.html">An improved, default run command</a></li><li><a href="/guide/host/environment.html">A new command for environment check support</a></li><li><a href="/guide/host/extensions.html">Ability to add your own commands running in the context of your application</a></li><li><a href="/guide/host/describe.html">Extensible diagnostic data about your application</a></li></ul><p>To enable the extended command line options in your .Net application bootstrapped by <code>IHostBuilder</code>, first install the <code>Oakton</code> nuget to your project. Then modify the <code>Program.Main()</code> method generated by the typical .Net project templates as shown in some of the examples below:</p><h2 id="net-6-console-integration" tabindex="-1">.Net 6 Console Integration <a class="header-anchor" href="#net-6-console-integration" aria-hidden="true">#</a></h2><p>In .Net 6, you have the option to allow .Net to magically create a <code>Program.Main()</code> entry point over the code in the <code>Program</code> file. Oakton integration with <code>IHost</code> works every so slightly differently than the .Net 5 and before versions, but you can see an example below:</p><p><a id="snippet-sample_bootstrapping_minimal_api"></a></p><div class="language-cs"><pre><code><span class="token keyword">using</span> <span class="token namespace">Oakton</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> WebApplication<span class="token punctuation">.</span><span class="token function">CreateBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This isn&#39;t required, but it &quot;helps&quot; Oakton to enable</span>
<span class="token comment">// some additional diagnostics for the stateful resource </span>
<span class="token comment">// model</span>
builder<span class="token punctuation">.</span>Host<span class="token punctuation">.</span><span class="token function">ApplyOaktonExtensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> app <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">MapGet</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Note the usage of await to force the implied</span>
<span class="token comment">// Program.Main() method to be asynchronous</span>
<span class="token keyword">return</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">RunOaktonCommands</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/MinimalApi/Program.cs#L1-L19" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_bootstrapping_minimal_api" title="Start of snippet">anchor</a></sup></p><p>Just note that the <code>return await app.RunOaktonCommands(args);</code> line at the bottom is important because:</p><ol><li>Using <code>return</code> here tells .Net to make the <code>Program.Main()</code> return an exit code that the OS itself needs in order to understand if an execution was successful or not -- and one of the common usages of Oakton is to create validation commands that require this.</li><li>Using <code>await</code> here tells .Net to make <code>Program.Main()</code> return <code>Task&lt;int&gt;</code> and execute asynchronously instead of Oakton having to do evil <code>.GetAwaiter().GetResult()</code> calls behind the scenes.</li><li><code>RunOaktonCommands()</code> makes the .Net program use Oakton as the command line executor to begin with</li></ol><h2 id="old-school-program-main" tabindex="-1">&quot;Old School Program.Main()&quot; <a class="header-anchor" href="#old-school-program-main" aria-hidden="true">#</a></h2><p>Oakton usage for &quot;old school&quot; &lt; .Net 6 applications is very similar:</p><p><a id="snippet-sample_using_run_oakton_commands_3"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
            
            <span class="token comment">// This extension method replaces the calls to</span>
            <span class="token comment">// IWebHost.Build() and Start()</span>
            <span class="token punctuation">.</span><span class="token function">RunOaktonCommands</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IHostBuilder</span> <span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        Host<span class="token punctuation">.</span><span class="token function">CreateDefaultBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ConfigureWebHostDefaults</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseStartup</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Startup<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/MvcApp/Program.cs#L37-L54" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_using_run_oakton_commands_3" title="Start of snippet">anchor</a></sup></p><p>or with <code>IWebHostBuilder</code>:</p><p><a id="snippet-sample_using_run_oakton_commands"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">CreateWebHostBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
            
            <span class="token comment">// This extension method replaces the calls to</span>
            <span class="token comment">// IWebHost.Build() and Start()</span>
            <span class="token punctuation">.</span><span class="token function">RunOaktonCommands</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IWebHostBuilder</span> <span class="token function">CreateWebHostBuilder</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        WebHost<span class="token punctuation">.</span><span class="token function">CreateDefaultBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseStartup</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Startup<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/MvcApp/Program.cs#L17-L34" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_using_run_oakton_commands" title="Start of snippet">anchor</a></sup></p><p>There are just a couple things to note:</p><ol><li>The return value of the <code>Program.Main()</code> method now needs to be <code>Task&lt;int&gt;</code> rather than <code>void</code>. This is done so that Oakton can return either successful or failure exit codes for usage in diagnostic commands you may want to stop automated builds upon failures.</li><li>You will use the <code>RunOaktonCommands()</code> method to accept the command line arguments and invoke your system rather than manually building and/or starting the <code>IWebHost</code> yourself</li></ol></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/JasperFx/oakton/edit/master/docs/guide/host/index.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>Suggest changes to this page <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/guide/commands" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>Commands</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/guide/host/run" data-v-38ede35f><span class="text" data-v-38ede35f>Improved &quot;Run&quot; Command</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"guide_bootstrapping.md\":\"b8b164b8\",\"guide_commands.md\":\"d1d55b30\",\"guide_discovery.md\":\"4b8bb157\",\"guide_getting_started.md\":\"be55ae46\",\"guide_help.md\":\"effcb29e\",\"guide_host_describe.md\":\"cf4a81b3\",\"guide_host_environment.md\":\"085a2083\",\"guide_host_extensions.md\":\"34826a9f\",\"guide_host_index.md\":\"9f9fb1df\",\"guide_host_resources.md\":\"030507ae\",\"guide_host_run.md\":\"f689bcd2\",\"guide_index.md\":\"ebaacaef\",\"guide_opts.md\":\"48842e7b\",\"guide_parsing.md\":\"b2a2f68a\",\"index.md\":\"780ab9bd\"}")</script>
    <script type="module" async src="/assets/app.148d2893.js"></script>
    
  </body>
</html>